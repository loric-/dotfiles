{
    "description": "Packer template for ubuntu bionic 18 desktop",
    "variables": {
        "vm_name": "Ubuntu-18.04",
        "iso_name": "ubuntu-18.04.2-desktop-amd64.iso",
        "iso_checksum": "22580b9f3b186cc66818e60f44c46f795d708a1ad86b9225c458413b638459c4",
        "iso_checksum_type": "sha256",
        "ssh_name": "dev",
        "ssh_pass": "dev",
        "num_cpus": "4",
        "mem_size": "8192",
        "disk_size": "40960"
    },
    "builders": [{
        "type": "vmware-iso",
        "guest_os_type": "ubuntu-64",
        "vm_name": "{{user `vm_name`}}",

        "output_directory": "output",
        "http_directory": "http",

        "iso_checksum": "{{user `iso_checksum`}}",
        "iso_checksum_type": "{{user `iso_checksum_type`}}",
        "iso_urls": [
            "./iso/{{user `iso_name`}}",
            "http://releases.ubuntu.com/bionic/{{user `iso_name`}}"
        ],

        "ssh_username": "{{user `ssh_name`}}",
        "ssh_password": "{{user `ssh_pass`}}",
        "ssh_port": 22,
        "ssh_wait_timeout": "10000s",

        "disk_size": "{{user `disk_size`}}",
        "disk_type_id": "0",
        "vmx_data": {
          "memsize": "{{user `mem_size`}}",
          "numvcpus": "{{user `num_cpus`}}"
        },
        "keep_registered": "false",
        "headless": "false",

        "boot_wait": "6s",
        "boot_command": [
            "<esc><esc><f6><esc><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
            " auto=true priority=critical noprompt ",
            " automatic-ubiquity ",
            " url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
            " keyboard-configuration/layoutcode=fr ",
            " keyboard-configuration/variantcode=bepo ",
            " ubiquity/reboot=true ",
            " languagechooser/language-name=English ",
            " countrychooser/shortlist=FR ",
            " localechooser/supported-locales=en_GB.UTF-8 ",
            " debian-installer/locale=en_GB ",
            " netcfg/choose_interface=auto ",
            " boot=casper ",
            " initrd=/casper/initrd ",
            " quiet splash noprompt noshell ",
            " --- <wait>",
            "<enter><wait>"
        ],

        "shutdown_command": "echo 'dev' | sudo -S shutdown -P now"
    },
    {
        "type": "virtualbox-iso",
        "guest_os_type": "Ubuntu_64",
        "vm_name": "{{user `vm_name`}}",

        "output_directory": "output",
        "http_directory": "http",

        "iso_checksum": "{{user `iso_checksum`}}",
        "iso_checksum_type": "{{user `iso_checksum_type`}}",
        "iso_urls": [
            "./iso/{{user `iso_name`}}",
            "http://releases.ubuntu.com/bionic/{{user `iso_name`}}"
        ],

        "ssh_username": "{{user `ssh_name`}}",
        "ssh_password": "{{user `ssh_pass`}}",
        "ssh_port": 22,
        "ssh_wait_timeout": "10000s",

        "disk_size": "{{user `disk_size`}}",
        "guest_additions_path": "VBoxGuestAdditions.iso",
        "virtualbox_version_file": ".vbox_version",
        "vboxmanage": [
            ["modifyvm", "{{.Name}}", "--clipboard", "bidirectional"],
            ["modifyvm", "{{.Name}}", "--draganddrop", "bidirectional"],
            ["modifyvm", "{{.Name}}", "--accelerate3d", "on"],
            ["modifyvm", "{{.Name}}", "--vram", "256"],
            ["modifyvm", "{{.Name}}", "--memory", "{{user `mem_size`}}"],
            ["modifyvm", "{{.Name}}", "--cpus", "{{user `num_cpus`}}"],
            ["modifyvm", "{{.Name}}", "--bioslogofadein", "off"],
            ["modifyvm", "{{.Name}}", "--bioslogofadeout", "off"],
            ["modifyvm", "{{.Name}}", "--bioslogodisplaytime", "1000"],
            ["modifyvm", "{{.Name}}", "--usb", "on"],
            ["modifyvm", "{{.Name}}", "--audiocontroller", "hda"],
            ["modifyvm", "{{.Name}}", "--audioin", "on"],
            ["modifyvm", "{{.Name}}", "--audioout", "on"]
        ],
        "keep_registered": "false",
        "headless": "false",

        "boot_wait": "6s",
        "boot_command": [
            "<esc><esc><f6><esc><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
            " auto=true priority=critical noprompt ",
            " automatic-ubiquity ",
            " url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
            " keyboard-configuration/layoutcode=fr ",
            " keyboard-configuration/variantcode=bepo ",
            " ubiquity/reboot=true ",
            " languagechooser/language-name=English ",
            " countrychooser/shortlist=FR ",
            " localechooser/supported-locales=en_GB.UTF-8 ",
            " debian-installer/locale=en_GB ",
            " netcfg/choose_interface=auto ",
            " boot=casper ",
            " initrd=/casper/initrd ",
            " quiet splash noprompt noshell ",
            " --- <wait>",
            "<enter><wait>"
        ],

        "shutdown_command": "echo 'dev' | sudo -S shutdown -P now"
    }],
    "provisioners": [
        {
            "type": "shell",
            "script": "scripts/setup.sh",
            "execute_command": "echo 'dev' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
        },
        {
            "type": "shell",
            "script": "scripts/vmware-guest.sh",
            "only": ["vmware-iso"],
            "execute_command": "echo 'dev' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
        },
        {
            "type": "shell",
            "script": "scripts/virtualbox-guest.sh",
            "only": ["virtualbox-iso"],
            "execute_command": "echo 'dev' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
        },
        {
            "type": "shell",
            "script": "scripts/virtualbox-sound.sh",
            "only": ["virtualbox-iso"],
            "execute_command": "echo 'dev' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
        },
        {
            "type": "shell",
            "script": "scripts/cleanup.sh",
            "execute_command": "echo 'dev' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
        }
    ],
    "post-processors": [{
        "type": "compress",
        "output": "ubuntu-desktop-18-04-{{.BuilderType}}.zip"
    }]
}
